---
title: RaspberryPi で遊んでみた
author: hatak
layout: post
permalink: /2012/11/10/17630
categories:
  - 構築手順
tags:
  - archlinux
  - raspberrypi
---
思い立って RaspberryPi を注文したら結構早く手に入ったので、早速遊んでみました。

<img src="https://dl.dropboxusercontent.com/u/14531906/hatak.github.io/2012/11/RIMG0067-300x225.jpg" alt="" title="RaspberryPi" width="300" height="225" class="alignnone size-medium wp-image-17634" />

<!--more-->

[RaspberryPi][1] は、ARMCore プロセッサ搭載の小型基板です。もともと発売開始の頃に買おうとしていたのですが、ただでさえ発送までの時間がかかる上に、販売代理店のサイトで購入中にエラーになってしまってそのままあきらめていたのでした。 ところが、先日 [この記事][2] を見て思い出したので、買ってみたわけでした。

*   10/25 : 注文
*   10/30 : 発送通知メール
*   11/5 : 到着

イギリスからの発送なのでそれなりに時間がかかりますが、それでも元々の代理店よりはかなり早いと思います。値段は £29.99 + £4.99 (送料) の計 £34.98。日本円換算で 4,500 円程度です。

### 組み立て

[ModMyPi][3] は RaspberryPi 専用のカスタムケースなどを取り扱うネットショップです。今回は本体セットを購入したので、本体ボードとケースが送られてきます。が、組み立てというほどではなく載せてはめれば完了です。上下で色を選べるので、上を白、下を青にしてみました。

<img src="https://dl.dropboxusercontent.com/u/14531906/hatak.github.io/2012/11/RIMG0061-300x225.jpg" alt="" title="RaspberryPi and iPhone4S" width="300" height="225" class="alignnone size-medium wp-image-17633" />

iPhone と比べると大きさは同じくらいですが、厚さが3倍くらいあります。

あとは OS イメージを書き込んだ SD カードをスロットにいれ、LAN と電源を接続すれば準備完了です。

### SD カードの準備

RaspberryPi の公式から OS イメージがダウンロードできます。展開すると 2GB くらいになるので、利用する SD カードは 4GB 以上が推奨されています。今回は手元に余ってた Transcend の SDHC 16GB (Class10) を用意しました。

大容量の SDHC も昔に比べれば値段が安くなっているのでいいですね。

イメージはいくつか種類がありますが、今回はシンプルな ArchLinux を使うことにしました。 SD カードをマウントして書き込めばいいのですが、スクリプトを利用します。Github で公開されているのですが、残念なことに直さないと動きません。 オリジナルのブランチにもいろんな方から PullRequest があるのですが、反映されてない (しかも多すぎてどれが正しいのか分からない) ので、やむを得ず動く状態に直したものを用意しました。

[hatak/RasPiWrite · GitHub][4]

コロンが抜けてるところと、インデントのおかしな所を直しただけのバージョンです。MacOSX 10.8.2 の python で動作しました。

ローカルに取得した後、スクリプトを起動してウィザードに沿って SD カードへの展開を進めます。mac の SD カードスロットに差し込み、スクリプトを sudo で実行します。

<div>
  [code gutter="false" toolbar="false"] $ sudo ./raspiwrite.py Password: ;d0KOd. .oOK0x: 0xlllcoxolkolllloX ;OccloddKNdxdocckc .dkddkWNNMOdoxd, .o:,x0....xd,ck' K:xOoloOOccloocW .x;N:....xO....'K;k, O..Nc...:XNl...:X.,X .kkx0NXk'...dNNxldK' 'k...0o....,O...d: ;o;'oM0olkWc.;oc .cOx....dOl. .x00k. //////////////////////// * Raspberry Pi SD Writer * Matt Jump * exaviorn.com //////////////////////// (Version 1.15 -MACOSX-) Checking for updates... There was an error in checking for an update: HTTPError() The following script is designed to copy a Raspberry Pi compatible disk image to an SD Card INCORRECTLY FOLLOWING THE WIZARD COULD RESULT IN THE CORRUPTION OF YOUR HARD DISK, PARTITIONS OR A BACKUP USB DRIVE (INCLUDING MOUNTED TIME MACHINE BACKUP DRIVES) It is advisable to remove any other USB HDDs or memory sticks, the wizard might select that one, if you have multiple hard drives installed, please take a LOT of care selecting the right drive Now insert your SD Card, press enter when you are ready... --------------------------------------------------------- The following drives were found, please verify the name of the SD card in finder with the name under the 'Mounted On' column (after '/volumes/'): Filesystem Size Used Avail Capacity iused ifree %iused Mounted on /dev/disk1s2 465Gi 434Gi 31Gi 94% 113643047 8243695 93% /Volumes/Data /dev/disk2s1 15Gi 2.2Mi 15Gi 1% 0 0 100% /Volumes/NO NAME --------------------------------------------------------- I believe this is your SD card: /dev/disk1s2 is that correct? (Y/n) n Please enter the location you believe holds the SD Card: /dev/disk2s1 I believe this is your SD card: /dev/disk2s1 is that correct? (Y/n) Y Unmounting the drive in preparation for writing... Volume NO NAME on disk2s1 unmounted Do you wish to Download a Raspberry Pi compatible image (choose yes if you don't have one) (Y/n): n Please locate the disk image (.zip, .img.gz, .tar.bz2 (.tar.bz2 only working with QtonPi distros currently): /Users/hatak/raspi/archlinux-hf-2012-09-18.img Found Image file Found archive inputted by user, extracting... archive already has been extracted, skipping unzipping... /Users/hatak/raspi/archlinux-hf-2012-09-18.img ################################################################### About to start the transfer procedure, here is your setup: > OS Choice: /Users/hatak/raspi/archlinux-hf-2012-09-18.img > SD Card: /dev/disk2 > Type: Obtained by user and passed in (potentially dangerous) Please remember that neither Matt Jump, exaviorn.com or any contributors can be held to warranty for any destruction of data or hardware (excerpt from GNU GPL, which can be found in the script's source, as well as inside the script's folder): ----------------------------------------------------------------- This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. ----------------------------------------------------------------- ################################################################### Please verify this information before typing 'accept' to accept the terms and to start the process, if this information isn't correct, please press ctrl + c (^C), or type 'exit' to quit: accept Running dd bs=1m if=/Users/hatak/raspi/archlinux-hf-2012-09-18.img of=/dev/disk2... Waiting...................................................................................................................................................................................................................................................................................................................................1886+0 records in 1886+0 records out 1977614336 bytes transferred in 971.250205 secs (2036153 bytes/sec) done! .Transfer Complete! Please remove the SD card ########################################### Relevent information: > Debian - Login is pi/raspberry > Arch - Login is root/root > Fedora - Login is root/fedoraarm > QtonPi - Login is root/rootme ########################################### Thank You for using RasPiWrite, you are now free to eject your drive [/code]
</div>

これでイメージ完成です。簡単ですね。 スクリプトに sudo が必要なのはマウント周りの操作を行うためかと思いますが、複数ディスクがある場合などは全部フォーマットされてしまう可能性もあるので十分に注意が必要です。

### 起動

できあがった SD カードを入れ、LAN ケーブルを挿し、電源を挿します。スイッチはないので、電源をつないだら基板の LED がひかり、10秒ほどで起動します。デフォルトは DHCP 取得になっているので、ルータ等で割り当て IP を調べて ssh するのがよさそうです。

<div>
  [code gutter="false" toolbar="false"] [root@alarmpi ~]# pacman -Sy [root@alarmpi ~]# pacman -Syu [/code]
</div>

<div>
  [code gutter="false" toolbar="false"] [root@alarmpi ~]# uname -a Linux alarmpi 3.2.27-5-ARCH+ #1 PREEMPT Fri Sep 14 13:23:44 UTC 2012 armv6l GNU/Linux [root@alarmpi ~]# df -hT Filesystem Type Size Used Avail Use% Mounted on rootfs rootfs 1.8G 523M 1.2G 32% / /dev/root ext4 1.8G 523M 1.2G 32% / devtmpfs devtmpfs 92M 0 92M 0% /dev tmpfs tmpfs 92M 0 92M 0% /dev/shm tmpfs tmpfs 92M 304K 92M 1% /run tmpfs tmpfs 92M 0 92M 0% /sys/fs/cgroup tmpfs tmpfs 92M 0 92M 0% /tmp /dev/mmcblk0p1 vfat 94M 21M 74M 22% /boot [root@alarmpi ~]# free total used free shared buffers cached Mem: 446888 48856 398032 0 9268 20624 -/+ buffers/cache: 18964 427924 Swap: 0 0 0 [root@alarmpi ~]# ps auxf USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 2 0.0 0.0 0 0 ? S 16:47 0:00 [kthreadd] root 3 0.0 0.0 0 0 ? S 16:47 0:00 _ [ksoftirqd/0] root 5 0.0 0.0 0 0 ? S 16:47 0:00 _ [kworker/u:0] root 6 0.0 0.0 0 0 ? S< 16:47 0:00 _ [cpuset] root 7 0.0 0.0 0 0 ? S< 16:47 0:00 _ [khelper] root 8 0.0 0.0 0 0 ? S 16:47 0:00 _ [kdevtmpfs] root 9 0.0 0.0 0 0 ? S< 16:47 0:00 _ [netns] root 10 0.0 0.0 0 0 ? S 16:47 0:00 _ [sync_supers] root 11 0.0 0.0 0 0 ? S 16:47 0:00 _ [bdi-default] root 12 0.0 0.0 0 0 ? S< 16:47 0:00 _ [kblockd] root 13 0.0 0.0 0 0 ? S 16:47 0:00 _ [khubd] root 14 0.0 0.0 0 0 ? S< 16:47 0:00 _ [rpciod] root 15 0.0 0.0 0 0 ? S 16:47 0:00 _ [kworker/0:1] root 16 0.0 0.0 0 0 ? S 16:47 0:00 _ [khungtaskd] root 17 0.0 0.0 0 0 ? S 16:47 0:02 _ [kswapd0] root 18 0.0 0.0 0 0 ? S 16:47 0:00 _ [fsnotify_mark] root 19 0.0 0.0 0 0 ? S< 16:47 0:00 _ [nfsiod] root 20 0.0 0.0 0 0 ? S< 16:47 0:00 _ [crypto] root 30 0.0 0.0 0 0 ? S< 16:47 0:00 _ [kthrotld] root 31 0.0 0.0 0 0 ? S< 16:47 0:00 _ [VCHIQ-0] root 32 0.0 0.0 0 0 ? S< 16:47 0:00 _ [VCHIQr-0] root 33 0.0 0.0 0 0 ? S< 16:47 0:00 _ [dwc_otg] root 34 0.0 0.0 0 0 ? S< 16:47 0:00 _ [DWC Notificatio] root 35 0.0 0.0 0 0 ? S 16:47 0:00 _ [kworker/u:1] root 36 2.6 0.0 0 0 ? S 16:47 1:59 _ [mmcqd/0] root 37 0.0 0.0 0 0 ? S 16:47 0:01 _ [jbd2/mmcblk0p2-] root 38 0.0 0.0 0 0 ? S< 16:47 0:00 _ [ext4-dio-unwrit] root 82 0.0 0.0 0 0 ? S< 16:47 0:00 _ [bcm2708_spi.0] root 384 0.0 0.0 0 0 ? S 17:23 0:00 _ [kworker/0:2] root 28528 0.0 0.0 0 0 ? S 17:54 0:00 _ [flush-179:0] root 1 0.0 1.2 4596 2396 ? Ss 16:47 0:01 /usr/lib/systemd/systemd --system --deserialize 28 root 46 0.0 0.6 3736 1208 ? Ss 16:47 0:00 /usr/lib/systemd/systemd-udevd root 50 0.0 1.0 5208 1996 ? Ss 16:47 0:00 /usr/lib/systemd/systemd-journald root 95 0.0 0.6 2772 1200 ? Ss 16:47 0:00 /usr/sbin/crond -n root 97 0.0 1.1 6248 2160 ? Ss 16:47 0:00 /usr/sbin/sshd -D root 163 0.0 1.6 9968 3140 ? Ss 16:49 0:02 _ sshd: root@pts/0 root 165 0.0 0.9 3272 1744 pts/0 Ss 16:49 0:00 _ -bash root 28579 0.0 0.5 2648 944 pts/0 R+ 18:03 0:00 _ ps auxf dbus 99 0.0 0.7 2808 1396 ? Ss 16:47 0:00 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation root 106 0.0 0.3 1752 676 tty1 Ss+ 16:47 0:00 /sbin/agetty --noclear tty1 38400 root 144 0.0 0.2 1928 516 ? Ss 16:47 0:00 /sbin/dhcpcd -A -q -w eth0 ntp 146 0.0 0.4 3508 792 ? S 16:47 0:00 /usr/sbin/ntpd -s root 147 0.0 0.3 3676 572 ? Ss 16:47 0:00 /usr/sbin/ntpd -s root 319 0.0 0.6 2996 1240 ? Ss 17:00 0:00 /usr/lib/systemd/systemd-logind root 385 0.0 1.5 7076 2900 ? Ss 17:23 0:00 /usr/sbin/syslog-ng -F [/code]
</div>

起動するとこんな感じです。ひとまず pacman でパッケージをアップデートしてあげたら、あとは好みに環境構築すればいいです。 うまく動かなくなったら、また SD カードを作り直せばいいですよね。

<div>
  [code gutter="false" toolbar="false"] [root@alarmpi ~]# cat /proc/meminfo MemTotal: 446888 kB MemFree: 397924 kB Buffers: 9300 kB Cached: 20624 kB SwapCached: 0 kB Active: 16772 kB Inactive: 17684 kB Active(anon): 4564 kB Inactive(anon): 168 kB Active(file): 12208 kB Inactive(file): 17516 kB Unevictable: 0 kB Mlocked: 0 kB SwapTotal: 1048572 kB SwapFree: 1048572 kB Dirty: 12 kB Writeback: 0 kB AnonPages: 4528 kB Mapped: 7264 kB Shmem: 208 kB Slab: 11436 kB SReclaimable: 8652 kB SUnreclaim: 2784 kB KernelStack: 384 kB PageTables: 360 kB NFS_Unstable: 0 kB Bounce: 0 kB WritebackTmp: 0 kB CommitLimit: 1272016 kB Committed_AS: 12868 kB VmallocTotal: 188416 kB VmallocUsed: 1004 kB VmallocChunk: 186592 kB [root@alarmpi ~]# cat /proc/cpuinfo Processor : ARMv6-compatible processor rev 7 (v6l) BogoMIPS : 697.95 Features : swp half thumb fastmult vfp edsp java tls CPU implementer : 0x41 CPU architecture: 7 CPU variant : 0x0 CPU part : 0xb76 CPU revision : 7 Hardware : BCM2708 Revision : 000f Serial : xxxxxxxxxxxxxxxx [/code]
</div>

とても手軽です。類似のものとしては Openblocks がありますが、桁一つ違うのは大きいですね。 Openblocks が一般的なサーバ機器で、RaspberryPi がパソコンくらいのイメージでしょうか。

## 参考

*   [MobileHackerz再起動日記: いつまでも届かないRaspberry Piは一手間かけると10日で新型が手に入る][2]
*   [ 約3,300円で買えるLinuxパソコンRaspberry PiをMacで使う | ひとりぶろぐ][5]
*   [Beginners' Guide - ArchWiki][6]</div>

 [1]: http://www.raspberrypi.org/
 [2]: http://blog.mobilehackerz.jp/2012/10/raspberry-pi10.html
 [3]: https://www.modmypi.com/
 [4]: https://github.com/hatak/RasPiWrite
 [5]: http://hitoriblog.com/?p=9733
 [6]: https://wiki.archlinux.org/index.php/Beginners%27_Guide
